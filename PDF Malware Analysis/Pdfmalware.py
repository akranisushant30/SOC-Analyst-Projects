import re
import os
import sys

def pdf_analyzer(file_path):
    #clean file path
    file_path = file_path.strip().replace('"','').replace("'","")

    if not os.path.exists(file_path):
        print(f"[!] Error: File Not Found! Check Path")
        return
    print (f"[*] Analyzing File: {file_path}")
    risk_score = 0

    try:
        #Read Raw Binary Data of PDF file
        with open(file_path,'rb') as file:
            raw_data = file.read().decode('latin-1',errors='ignore')

        print(f"\n[+] Basic File Info:")
        if "%PDF-" in raw_data:
            print(f"    Version: {raw_data[:8]}")
        #Keyword Detection
        suspicious_tag = {
            '/JS': 'JavaScript detected',
            '/JavaScript': 'JavaScript detected',
            '/OpenAction': 'Auto-run on open detected',
            '/URI': 'External link detected'
        }

        print("\n[+] Scanning for Sucpicious Indicator")
        for tag, desc in suspicious_tag.items():
            if tag in raw_data:
                count = raw_data.count(tag)
                print(f"[!] Alert found {tag} ({count}: Times) -> {desc}")
                risk_score +=3 * count

        #URLs Extraction
        urls = re.findall(r'https?://[^\s<>"]+|www\.[^\s<>"]+',raw_data)
        if urls:
            print(f"\n[+] Extracted IOCs (Links):")
            for u in list(set(urls)):
                print(f"-> {u}")
                risk_score +=2
        #final_report
         # Final Report
        print("\n" + "="*40)
        status = "HIGH RISK" if risk_score >= 5 else "CLEAN / LOW RISK"
        print(f"FINAL REPORT: {status} (Score: {risk_score})")
        print("="*40)
    except Exception as e:
        print(f"[!] Error: {e}")

if __name__ == "__main__":
    path = sys.argv[1]
    pdf_analyzer(path)
